\documentclass[11pt,spanish]{article}

%% Language and font encodings
\usepackage[utf8x]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[spanish,activeacute]{babel}

%% Sets page size and margins
\usepackage[a4paper,top=3cm,bottom=2cm,left=3cm,right=3cm,marginparwidth=1.75cm]{geometry}
\usepackage{indentfirst}

%% Useful packages
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage[]{hyperref}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{listings}
\usepackage{xcolor}

\author{
\Large Christian González García-Muñoz \\ 
\Large Alejandro Huertas Herrero 
}
\date{}
\begin{document}
\begin{titlepage}
	\centering
    \includegraphics[width=8cm]{ucm-logo.png}
    \vskip 1cm
    
    \centering
    {\huge Reconocimiento de actividades domésticas en personas con enfermedades neurodegenerativas mediante una pulsera de sensores 
    }
    \newline
    \newline
    \newline
    \newline
    
	\centering \large { Christian González García-Muñoz \\  Alejandro Huertas Herrero \\ 
    					\bigskip Dirigido por: Javier Arroyo \\ Codirigido por: Marlon Cárdenas \\ \bigskip}
    \vskip 1cm
    \centering \Large { Trabajo de fin de grado del Grado en Ingeniería Informática }
	\vskip 1cm
    \centering \large {Facultad de Informática \\ Universidad Complutense de Madrid \\ Curso 2017-2018}
    \vskip 0.5cm
    \centering \large {21 Mayo de 2018}

\end{titlepage}
\clearpage
\vphantom{a}
\newpage

\addtocontents{toc}{\protect\setcounter{tocdepth}{0}}

\section*{Resumen}
\addcontentsline{toc}{section}{Resumen}
El objetivo del proyecto es implementar una aplicación Android y toda la infraestructura necesaria para dar soporte a las funcionalidades de esta. La aplicación facilita tanto el día a día del paciente como el diagnostico de la enfermedad por parte del medico. En concreto, la aplicación permite al paciente (o al encargado del cuidado del mismo) añadir recordatorios con los días y horarios en los que debe tomar cada pastilla y tener un diario de las actividades que el paciente realiza como parte de su rutina de ejercicios, ya sea esta propia o recomendada por un medico. Todas estas acciones son monitorizadas por sensores BLE (Bluetooth de baja energía) conectados a la aplicación para después ser procesados y representados de forma amigable para el medico que deba interpretarlos. 
\newline

La aplicación Android se complementa con una aplicación web sencilla e intuitiva que permite proporcionar datos al médico. En ella, se pueden visualizar mediante gráficos la evolución de los datos recogidos por los sensores de cada paciente.
\newline

Tanto la aplicación Android como la aplicación web hacen uso de un API REST para enviar o recibir datos del back-end.
\newline

Como se ha dicho anteriormente, la aplicación permite monitorizar al paciente mediante sensores BLE. La aplicación soporta dos tipos de sensores, por un lado tenemos un sensor más “rudimentario” y por otro lado un sensor mas amigable con el usuario que lo lleve, con forma de pulsera y con una pantalla incorporada. Ambos sensores cuentan a su vez con varios servicios, de los cuales los utilizados para este proyecto han sido los acelerómetros y los giroscopios, ambos de tres ejes. La integración de la aplicación Android con los sensores BLE ha sido una de las mayores dificultades que nos hemos encontrado a la hora de llevar a cabo el proyecto debido a la compleja interfaz que ofrece Android para trabajar con este tipo de sensores.
\newline

Resumiendo, las tecnologías utilizadas han sido las siguientes:

\begin{itemize}
    \item Android para el desarrollo de la aplicación. 
	\item SQLite para almacenar los datos dentro del teléfono. 
	\item Bluetooth Low Energy para la comunicación con los sensores. 
	\item Python para procesar los datos y para implementar el API REST
    \item PHP, HTML5 y Bootstrap para el desarrollo de la web que permite visualizar los datos.
	\item MongoDB para almacenar en el back-end todos los datos recogidos.
    \item Apache como servidor web para hostear la aplicación web.
    \item Docker para desplegar la infraestructura necesaria de forma automática (API REST, servidor web y MongoDB).  
    \newline
\end{itemize}

{\bf Palabras clave:} aplicación Android, teléfono inteligente, Parkinson, bluetooth, Internet de las cosas, sensores, movimiento, actividades, medicamentos y visualización.
\newpage

\section{Abstract}
The aim of this project is to develop an Android application and all the infrastructure necessary to support its functionalities. The aplication helps the patient into his everyday life and the diagnosis of the ilness by the doctor. More specific the aplication allows the patient (or the one in charge) to add pills reminders and have a history of all the activities that patient makes in its routine either the routine is set by a doctor or not. All the activitys are recorded by BLE sensors conected with the application in order to the data can be processed  and ploted later for the doctor who needs to interpret it.
\newline

The android application is complemented by a web application which allow the doctor see the plotted data.
\newline

As said before, the application allows to record the patient through BLE sensors. The application allows two different types of sensors, a rudimentary one which makes his job but is more uncomfortable to wear it and other one more comfortable with a watch band. Both sensors count with multiple services, we have made use of the acellerometer and gyroscope. The integration of the BLE sensors with the application have been one of our bigest challenge because of the complex interface that Android provide.
\newline

Summarizing, we have used the following technologies:

\begin{itemize}
    \item Android to develop the application. 
	\item SQLite to store data inside the smartphone. 
	\item Bluetooth Low Energy for the communication with the sensors. 
	\item Python to develop the server which stores and proccess the data (Eve framework)
    \item PHP, HTML5 y Bootstrap to develop the web application.
	\item Mongodb to store the data in the server.
    \item Apache as a web server for hosting the web application.
    \item Docker for deploy the infrastructure automatically (REST API, web server and MongoDB). 
    \newline
\end{itemize}
\newpage

\addtocontents{toc}{\protect\setcounter{tocdepth}{3}}

\newpage
\tableofcontents
\newpage
\listoffigures
\newpage

\section{Estado del arte}
“La enfermedad de Parkinson (EP), también denominada mal de Parkinson, parkinsonismo idiopático, parálisis agitante o simplemente párkinson, es una enfermedad neurodegenerativa crónica caracterizada por bradicinesia (movimiento lento), rigidez (aumento del tono muscular) y temblor.” - Wikipedia
\newline

Gran parte de los síntomas de la enfermedad son motores, por eso decidimos hacer una aplicación basada en la utilización de sensores. Se han hecho numerosos estudios los cuales utilizan esta tecnología y a su vez utilizan los datos recogidos para aplicar técnicas de análisis de datos como machine learning sobre ellos.
\newline

Para introducirnos en el estado del arte, leímos numerosos artículos científicos, en concreto los más útiles e interesantes, son los que se listan a continuación:
\newline

\begin{itemize}
	\item Quantitative wearable sensors for objective assessment of Parkinson’s diseases.
	\item Analysis of feature space for monitoring persons with Parkinson’s disease with application to a wireless wearable sensor system. 
	\item Detection of walking periods and number of steps in older adults and patients with Parkinson’s disease: accuracy of a pedometer and an accelerometry-based method. 
	\item Monitoring Motor Fluctuations in Patients With Parkinson’s Disease Using Wearable Sensors . 
	\item Feasibility and effects of home-based smartphone-delivered automated feedback training for gait in people with Parkinson’s disease: A pilot randomized controlled trial.
	\item An accelerometry-based study of lower and upper limb tremor in Parkinson’s disease. 
	\item Detecting and monitoring the symptoms of Parkinson’s disease using smartphones: A pilot study.
	\item A smartphone-base architecture to detect and quantify freezing of gait in parkinson’s disease.
    \newline
\end{itemize}

Todos ellos tienen como nexo común, la utilización de sistemas basados en sensores para analizar las actividades que realizan los pacientes. La mayoría de ellos utilizan cuadros de actividades fijados previamente. 
\newline

Nuestra aplicación está diseñada para poder usarla para monitorizar al paciente en un entorno libre, en su día a día, o mientras realiza una tabla de ejercicios previamente definida, en este caso nuestra aplicación permite cruzar los datos de monitorización obtenidos con los horarios de la toma de la medicación, de esta forma se podría ver el efecto que tienen los medicamentos sobre cada paciente.
\newpage

\section{Aplicación Android}
\subsection{Descripción}
La aplicación ha sido desarrollada para dispositivos Android, con una versión igual o superior a Android 4.4 (KitKat) Cuenta con un diseño sencillo e intuitivo, ya que está pensada para personas que pueden tener temblores mientras la usen o pueden encontrarse en una avanzada edad. Toda la recogida de datos de los sensores está automatizada, el paciente sólo tiene que conectar la aplicación con cada sensor y puede olvidarse del teléfono en ese momento. Se ha intentado que la aplicación sea lo menos invasiva posible, para ello tan sólo cuenta con notificaciones cuando se tiene que tomar las pastillas. Cada notificación indica la pastilla que debe tomarse y cuenta con dos opciones, de esta forma se puede llevar un control de las pastillas que se ha tomado (esto quedaría pendiente como trabajo futuro)
\newline

\subsection{Capturas}
\subsubsection{Menú inicio}
\begin{figure}[!htb]
\centering
\includegraphics[width=0.25\textwidth]{Inicio.jpg}
\caption{Pantalla principal de la aplicación.}
\end{figure}
Esta es la pantalla que aparece cuando se inicia la aplicación. Podemos ver dos grandes botones, el primero de ellos permite acceder a todo lo relacionado con las actividades y el segundo a todo lo relacionado con los medicamentos.
\newline

Puede verse como en el menú superior hay dos botones. El botón de enviar, permite enviar todos los datos al servidor. El botón emparejar permite acceder al menú dónde se configuran y se emparejan los sensores con la aplicación.
\newpage

\subsubsection{Actividades}
\begin{figure}[!htb]
\minipage{0.32\textwidth}
  \includegraphics[width=\linewidth]{Actividades.jpg}
  \caption{Actividades}
\endminipage\hfill
\minipage{0.32\textwidth}
  \includegraphics[width=\linewidth]{AnyadirActividad.jpg}
  \caption{Añadir actividad}
\endminipage\hfill
\minipage{0.32\textwidth}%
  \includegraphics[width=\linewidth]{MenuActividades.jpg}
  \caption{Menú actividad}
\endminipage
\end{figure}

Las tres pantallas de arriba muestran cómo se trabaja con las actividades. La pantalla principal cuenta con una lista de todas las actividades que se realizan, a modo de histórico y con un botón que permite añadir una nueva actividad al sistema.
\newline

La información que se guarda de cada actividad es:

\begin{itemize}
	\item {\bf Nombre} de la actividad.
	\item {\bf Duración} de la actividad.
	\item {\bf Hora y fecha} en las que se realizó la actividad.
	\item Cualquier {\bf observación} que pueda hacer que los datos recogidos por los sensores en esa actividad no sean válidos.
\end{itemize}

La actividad puede ser añadida antes o después de realizarla, lo importante es que mientras se realice los sensores están conectados y recogiendo datos.
\newline

Al pulsar en el botón de añadir actividad (botón flotante de abajo a la derecha) se nos abre un cuadro de diálogo en el que podemos rellenar cada uno de los campos. Las actividades están prefijadas de antemano, sólo se incorporan aquellas que son más importantes para posteriores estudios.
\newline

Por último, cada actividad cuenta con tres puntitos, los cuales despliegan el menú de opciones. Las opciones disponibles son editar y borrar. Editar abrirá un cuadro de diálogo como el de añadir, pero con todos los campos rellenos con la información de dicha actividad (aparecerán bloqueados aquellos que no se puedan editar) Borrar abrirá un cuadro de diálogo preguntando si de verdad se desea borrar la actividad, en caso afirmativo la actividad será borrada de la lista que contiene todas las actividades.

\subsubsection{Medicamentos}
\begin{figure}[!htb]
\minipage{0.32\textwidth}
  \includegraphics[width=\linewidth]{Medicamentos.jpg}
  \caption{Medicamentos}
\endminipage\hfill
\minipage{0.32\textwidth}
  \includegraphics[width=\linewidth]{AnyadirMedicamento.jpg}
  \caption{Añadir medicamento}
\endminipage\hfill
\minipage{0.32\textwidth}%
  \includegraphics[width=\linewidth]{MenuMedicamentos.jpg}
  \caption{Menú medicamento}
\endminipage
\end{figure}

Las tres pantallas de arriba muestran cómo se trabaja con los medicamentos. La pantalla principal cuenta con una lista de todos los medicamentos que tiene que tomar el paciente y con un botón que permite añadir un nuevo medicamento al sistema.
\newline

La información que se guarda de cada medicamento es:

\begin{itemize}
	\item {\bf Nombre} del medicamento.
	\item {\bf Intervalo} para la recogida de datos. Este parámetro indica los minutos después de la toma del medicamento, en los que los datos recogidos por los sensores podrían verse alterados debido al efecto de la medicación.
	\item {\bf Días de la semana} en los que se tiene que tomar la medicación.
	\item {\bf Hora} a la que se tiene que tomar la medicación.
\end{itemize}

Una vez es añadido el medicamento, la próxima vez que se inicie la aplicación se programarán notificaciones que avisarán al paciente de cuándo se tiene que tomar cada medicamento ese día.
\newline

Al pulsar en el botón de añadir medicamento (botón flotante de abajo a la derecha) se nos abre un cuadro de diálogo en el que podemos rellenar cada uno de los campos.
\newline

Por último, cada medicamento cuenta con tres puntitos, los cuales despliegan el menú de opciones. Las opciones disponibles son editar y borrar. Editar abrirá un cuadro de diálogo como el de añadir, pero con todos los campos rellenos con la información de dicho medicamento (aparecerán bloqueados aquellos que no se puedan editar) Borrar abrirá un cuadro de diálogo preguntando si de verdad se desea borrar el medicamento, en caso afirmativo el medicamento será borrado de la lista que contiene todos los medicamentos.

\subsubsection{Servidor}
\begin{figure}[!htb]
\centering
\includegraphics[width=0.25\textwidth]{EnviarDatos.jpg}
\caption{Enviar datos al servidor.}
\end{figure}

El botón de enviar que se encuentra situado arriba a la derecha, permite enviar todos los datos al servidor. Se enviarán los datos recogidos por los sensores, las actividades realizadas por el paciente y los medicamentos que se tiene que tomar.
\newline

Una vez pulsamos el botón, se abre el cuadro de progreso que puede verse en la imagen. Desaparece una vez todos los datos han sido enviados. Después se informa al usuario de si ha ido todo bien o ha fallado algo.
\newline

\subsubsection{Configuración}
\begin{figure}[!htb]
\centering
\includegraphics[width=0.25\textwidth]{Emparejar_1_.jpg}
\caption{Pantalla de configuración.}
\end{figure}

Cuando pulsamos en el botón emparejar que puede verse en la parte superior derecha (anterior imagen) nos aparece esta pantalla.

En ella se pueden configurar los sensores. Permite indicar el rango del acelerómetro (“es el rango de amplitud máxima que puede medir el acelerómetro antes que la señal de salida resulte distorsionada o recortada. Normalmente se especifica en "g".”)
\newline

El periodo con el que se desean recoger los datos.
Qué sensores se desean activar.
Y en qué parte del cuerpo se va a poner cada uno de los sensores.
\newline

Una vez le demos a comenzar, podremos emparejar el sensor con la aplicación y comenzar a recoger datos.
\newline

\subsubsection{Ayuda}
\begin{figure}[!htb]
\centering
\includegraphics[width=0.25\textwidth]{Ayuda.jpg}
\caption{Ayuda menú inicio.}
\end{figure}

En todas las pantallas de la aplicación puede verse un botón flotante abajo a la izquierda, es el botón de ayuda. Puesto que la aplicación está dirigida a pacientes de Parkinson, en su gran mayoría tienen avanzada edad, consideramos que era buena idea incluir un botón que muestre información acerca de cómo se realiza cada acción.
\newline

El botón de ayuda, muestra en cada pantalla cómo realizar todas las acciones permitidas en dicha pantalla. Como podemos ver en este caso muestra cómo acceder a cada apartado, así como enviar datos y conectar los sensores. Resalta en negrita las partes más importantes, para que puedan ser vistas de forma sencilla y rápida.
\newpage

\subsection{Diagramas UML (Casos de uso)}
\begin{figure}[!htb]
\minipage{0.5\textwidth}
  \includegraphics[width=\linewidth]{AplicacionUML.png}
  \caption{Aplicación}
\endminipage\hfill
\minipage{0.5\textwidth}
  \includegraphics[width=\linewidth]{ActividadesUML.png}
  \caption{Actividades}
\endminipage\hfill
\end{figure}

\begin{figure}[!htb]
\minipage{0.5\textwidth}%
  \includegraphics[width=\linewidth]{MedicamentosUML.png}
  \caption{Medicamentos}
\endminipage
\minipage{0.5\textwidth}%
  \includegraphics[width=\linewidth]{SensoresUML.png}
  \caption{Sensores}
\endminipage
\end{figure}
\newpage

\section{Arquitectura de la aplicación Android}
\subsection{Descripción}
La aplicación no sigue ninguna arquitectura concreta. El patrón que más se le aproxima es Modelo Vista Controlador (MVC) De los tres elementos tendríamos bien diferenciados dos de ellos. Por un lado tenemos la vista, que la forman todos los layouts y por otro los modelos que serían las actividades de Android.
\newline

Entrando más en detalle en los elementos que forman la aplicación. El almacenamiento de datos dentro del teléfono se realiza gracias a SQLite ("SQLite es una librería escrita en lenguaje C que implementa un manejador de base de datos SQL embebido.") En ella se guardan todos los datos del sensor que aún no han sido enviados al servidor (una vez se envían se borran de la base de datos local) los medicamentos y actividades (estos disponen de un campo que indica si se han enviado al servidor o no, porque a diferencia de los datos de los sensores, éstos no se borran nunca del teléfono) El diagrama entidad relación es el siguiente:
\newline

Otro de los elementos importantes es la gestión de la conexión con los sensores. La conexión con cada tipo de sensor se hace de forma diferente, ambas se realizan con librerías que se hemos encontrado en GitHub y hemos adaptado a nuestras necesidades. La aplicación permite conectar varios sensores de Texas Instruments a la vez, mientras que sólo permite conectar un sensor del tipo Hexiwear.
\newline

El último elemento a destacar son las llamadas a la API Rest. Se hacen mediante una librería de Android (Volley) Se utilizan mensajes JSON para transmitir toda la información, tanto de la aplicación a la API como viceversa.

\subsection{Diagrama}
\begin{figure}[h!]
  \centering
  \includegraphics[width=0.9\textwidth]{ArquitecturaAndroid.png}
  \caption{Arquitectura aplicación Android.}
\end{figure}

\subsection{Estructura de clases}
El código de la aplicación se está organizado en tres grandes grupos:

\begin{itemize}
	\item {\bf Actividades: } en este paquete se encuentran todas las actividades que forman la aplicación de Android. Esto se corresponde con cada una de las funcionalidades de la aplicación, es decir, actividades, medicamentos y recogida de los datos recogidos por los sensores.
    \item {\bf Adaptadores: } son principalmente dos, uno para las actividades y otro para los medicamentos. Permiten la creación de listas personalizadas en Android. De esta forma podemos mostrar de una forma sencilla e intuitiva toda la información relacionada con cada elemento, así como editar y borrar cada uno de ellos.
    \item {\bf Clases: } aquí podemos encontrar gran variedad. Por un lado están las clases que representan cada objeto dentro de la aplicación. Por otro lado están los servicios que gestionan las conexión bluetooth con los sensores. Por último, se encuentra la clase que conecta la aplicación con la API rest.
\end{itemize}

\section{Sensores}
\subsection{Texas Instrument: CC2650 - Ultra-low power wireless MCU}
{\bf Descripción}
\newline

El dispositivo es un sensor BLE (Bluetooth Low Energy) es decir, es bluetooth de bajo consumo. Cuenta con varios sensores dentro del propio dispositivo. Se puede conectar con cualquier dispositivo que disponga de bluetooth, en nuestro caso se ha utilizado conectándolo con un teléfono móvil. 

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.5\textwidth]{SensorTexas.jpg}
  \caption{Sensor CC2650.}
\end{figure}

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.5\textwidth]{FundaTexas.png}
  \caption{Aspecto del sensor con la funda.}
\end{figure}

{\bf Hardware}
\newline

El dispositivo contiene un procesador ARM de 32 bits que funciona a 48 MHz, el cual se encarga de controlar el funcionamiento de todos los sensores que lo forman. Los servicios disponibles son los siguientes:

\begin{itemize}
  \item Sensor de temperatura.
  \item Sensor de movimiento (acelerómetro y giroscopio)
  \item Sensor de humedad.
  \item Sensor de presión.
  \item Sensor óptico.
\end{itemize}

\begin{figure}[h!]
  \centering
  \includegraphics[width=\textwidth]{ArquitecturaTexas.jpg}
  \caption{Arquitectura interna sensor texas.}
\end{figure}

{\bf Software}
\newline

Para interactuar con el sensor se puede utilizar cualquier dispositivo que tenga bluetooth, desde un dispositivo móvil hasta un ordenador. Existen librerías en Python que facilitan la interacción con el mismo. Para acceder a los sensores se utilizan direcciones físicas, conocidas como UUID (Universally Unique Identifier) También hay UUID que permiten configurar el sensor para cambiar parámetros como la frecuencia de funcionamiento, que sensores deben activarse, etc...
\newline

{\bf Uso}
\newline

El sensor lo hemos utilizado con Android. Para ello hemos creado una aplicación móvil que se conecta al sensor y obtiene los datos de él. Para la conexión con el sensor se utiliza la dirección MAC que tiene asociada. Antes de realizar la conexión, se indican que servicios se desean activar y con que frecuencia se quieren recoger datos. Después, se realiza un escaneo y al seleccionar el sensor se empareja con él y comienza a leer datos. Los datos son almacenados en el teléfono y posteriormente son enviados a la nube para su posterior tratamiento.

\subsection{Hexiwear}
{\bf Descripción}
\newline

Es un dispositivo pensado para IoT (Internet de las cosas) bastante pequeño y con un diseño amigable que permite usarlo como reloj inteligente. Hexiwear es un sensor bastante versátil completamente software libre.
\newline

\begin{figure}
  \centering
  \includegraphics[width=6cm]{sensorHexiwearCorrea.png}
  \caption{Sensor Hexiwar con correa.}
\end{figure}

{\bf Harwdare}
\newline

El dispositivo cuenta con un MCU Kinetis K64x de NXP (ARM Cortex-M4, 120 MHz, 1M Flash, 256K SRAM), BLE NXP Kinetis KW4x (ARM® Cortex-M0+, Bluetooth Low Energy \& 802.15.4 Wireless MCU), batería de litio, pantalla OLED
de 1.1'', interfaz táctil y un led RGB. Ademas cuenta con los siguientes sensores:

\begin{itemize}
  \item Acelerómetro tridimensional.
  \item Magnetómetro tridimensional.
  \item Giroscopio triaxial.
  \item Sensor de presión.
  \item Sensor de pulsaciones.
  \item Sensor de humedad
  \item Sensor óptico
\end{itemize}

\begin{figure}[H]
  \centering
  \includegraphics[width=15cm]{Hexiwear-hardware-diagram.png}
  \caption{Diagrama del Hardware (Hexiwear).}
\end{figure}

{\bf Software}
\newline

Hexiwear ofrece aplicaciones tanto en iOS como en Android para interactuar con sus sensores, además ofrece una nube a traves de la cual recuperar los datos del sensor haciendo uso de un API REST. Dado que nuestra aplicación esta diseñada para ser capaz de monitorizar a un paciente en cualquier momento no podíamos hacer uso de la nube ya que necesita conexión a Internet. Nuestra aplicación integra la comunicación con el sensor haciendo uso de BLE.
\newline

{\bf Uso}
\newline

Como se menciona en el apartado anterior la interacción con el sensor se hace a través de nuestra propia aplicación Android. Mientras el dispositivo esta conectado con la aplicación se recogen los datos de acelerómetro y giroscopio y se almacenan en la base de datos local de la aplicación para posteriormente enviarlos y procesarlos en el servidor remoto.

\newpage
\section{Infraestructura}
En esta sección se describe toda la infraestructura desplegada para dar soporte a las funcionalidades tanto de la aplicación Android como de la aplicación web. El siguiente esquema muestra como se relacionan los distintos componentes con las aplicaciones:

\begin{figure}[H]
  \centering
  \includegraphics[width=10cm]{components-interaction.png}
  \caption{Diagrama de interacción de los componentes de la infraestructura.}
\end{figure}


\subsection{API REST}
Para interactuar con la base de datos remota decidimos usar un API REST. Esto nos aporta una capa de separación entre el cliente y el servidor lo que aumenta la escalabilidad del proyecto y nos permite usar el mismo interfaz tanto para la aplicación Android como para la aplicación web.

\subsubsection{Detalles técnicos}
El API REST esta implementada usando Eve, un framework opensource basado en Python. Eve nos permite implementar y desplegar el API de una forma rapida y sencilla.

\subsubsection{Esquema de datos}

El esquema JSON definido para establecer la estructura de las llamadas al API, se corresponde con las tablas de la base de datos local de la aplicación Android añadiendo a cada tabla un campo identificador para cada cliente, este campo se coge automáticamente del dispositivo Android en el que se este usando la aplicación. Ademas el esquema cuenta con una tabla para usuarios de la aplicación web y otra con información del paciente asociada a su identificador."

\subsection{Servidor HTTP}
Hemos desplegado nuestro propio servidor web para servir la aplicación. El papel principal del servidor web es gestionar las diferentes sesiones ya que todos los datos que se muestran en la web se recogen median JavaScript haciendo uso del API REST. 

\subsubsection{Detalles técnicos}
Como servidor HTTP para servir la aplicación web hemos usado Apache Server sobre Ubuntu16.04 junto con PHP 7.0.

\subsection{Despliegue de la infraestructura}

Para facilitar el despliegue de la infraestructura se ha automatizado el proceso de despliegue usando Docker y un script en shell.

\subsubsection{Infraestructura sobre Docker}
Para desplegar la infraestructura sobre Docker hemos creado dos imágenes propias, partiendo de la imagen oficial de Ubuntu 16.04. En una de ellas se instala y despliega todo lo necesario para el API REST y en la otra se instala y se despliega todo lo necesario para el servidor web. Además hacemos uso de la imagen oficial de MongoDB para levantar la base de datos, lo que da lugar a tres contenedores de Docker enlazados como muestra el siguiente diagrama:

\begin{figure}[H]
  \centering
  \includegraphics[width=10cm]{containers-interaction.png}
  \caption{Diagrama de interacción de los contenedores de Docker.}
\end{figure}
\newpage

\subsubsection{Procesamiento de datos en el servidor}

Pese a que por dificultades ajenas al proyecto no hemos podido realizar una fase de interacción con usuarios reales para recopilar datos con los que poder trabajar y aplicar las técnicas de datos necesarias para poder extraer información de utilidad, hemos implementado un programa en Python que se encarga de procesar los datos almacenados, por el API REST, en la base de datos remota para producir datos que pudiesen ser usados para entrenar algoritmos de machine learning de una forma sencilla.
\newpage

\section{Conclusiones}
El trabajo lo comenzamos en julio del año pasado, la idea inicial era crear un sistema capaz de diferenciar temblores de cualquier otra actividad. Finalmente el trabajo ha ido en otra línea, pero todo lo que hemos hecho puede ser utilizado para el propósito inicial.
\newline

A pesar de todas las dificultades que hemos tenido debido a que no hemos encontrado pacientes con los que probar la aplicación, ni médicos dispuestos a darnos feedback, hemos hecho un trabajo bastante completo. Hemos creado un sistema capaz de recoger todos los datos de las actividades que realiza el paciente y que permite al médico visualizarlos en una aplicación web.
\newline

El trabajo que hemos hecho se parece bastante a muchos sistemas que vimos cuando estudiamos el estado del arte. Aunque, nuestro sistema está más orientado al paciente, ya que incluye todo el apartado de los medicamentos. Con ello también queremos que se pueda estudiar el efecto que tienen los medicamentos sobre el paciente. Por otro lado, los estudios que vimos en los artículos del estado del arte se centraban en la recogida y el análisis de datos, nosotros hemos querido centrarnos también en el médico, de forma que pueda visualizar los datos y poder ayudar al paciente en cierta forma.
\newline

Como conclusión final, a pesar de la falta de personas que prueben nuestra aplicación, se ha desarrollado un trabajo muy completo y cerrado. Es completamente funcional y se podría poner en funcionamiento en cualquier momento y a partir de esto ampliar y seguir con la idea inicial del proyecto.
\newpage

\section{Trabajo futuro}
El trabajo futuro se puede realizar en tres de los apartados de los que consta el proyecto. Mientras que en aspectos como la API o el despliegue de la arquitectura no tienen mucho trabajo, pues han quedado cerrados en esta iteración.

\subsection{Aplicación Android}
La aplicación podría ser completada añadiendo los siguientes elementos:

\begin{itemize}
	\item Gráficas en tiempo real con los datos que son recogidos por los sensores.
    \item Gestión de los temblores, que en un primer momento se planteó, pero que con el cambio del rumbo del TFG se descartó.
    \item Recordatorios personalizables para las pastillas. Ahora mismo la aplicación sólo manda una notificación a la hora en el día que se tiene que tomar la pastilla.
    \item Varias vistas de tal forma que el paciente vea una parte de la aplicación y su cuidador pueda acceder a otros datos.
    \item Que la comunicación con la pulsera sea bidireccional, de forma que se puedan enviar notificaciones a la pulsera.
    \item Utilizar vibración o sonidos dentro de las notificaciones o a la hora de alcanzar valores extraños por parte de los sensores, como por ejemplo que el sensor se ha desconectado o que el sensor está devolviendo valores erróneos.
    \item Por último, el diseño de la aplicación es bastante mejorable, aunque ahora es muy sencilla e intuitiva, quizás vendría bien tener diferentes diseños según el dominio del paciente.
\end{itemize}

\subsection{Aplicación Web}
La web podría ser completada añadiendo los siguientes elementos:

\begin{itemize}
	\item Permitir el registro de usuarios, tanto de médicos cómo de pacientes.
    \item Ahora mismo la web está orientada a la visualización de datos por parte del médico, pero quizás en un futuro sería interesante que el paciente la pudiera usar para ver sus datos, así cómo recomendaciones dadas por su médico.
    \item Actualmente sólo se muestran datos de actividades y medicamentos por paciente, en el futuro podrían mostrarse datos cruzados de pacientes e intentar así mejorar los diagnósticos.
    \item Permitir al usuario elegir el formato de cada uno de los gráficos que se muestran, así como seleccionar los datos que aparecen en ellos.
\end{itemize}

\subsection{Estudio de los datos}
Todos los datos recogidos en un primer momento iban a ser utilizados para aplicarles machine learning y así poder obtener predicciones acerca de la evolución del paciente. Todo el sistema está orientado para obtener los datos de forma sencilla y poder analizarlos en cualquier momento.
\newpage

\section{Aportaciones}
\subsection{Christian González}

Este proyecto esta caracterizado por que siempre que ha sido posible tanto mi compañero como yo hemos intentado trabar en grupo e intentar que ambos aportásemos nuestro granito de arena a cada una de las partes de este proyecto. Bien es cierto que para agilizar el desarrollo y ser capaces de cumplir con los plazos marcados por nosotros mismos y nuestros directores de proyecto hemos tenido que paralelizar tareas repartiendo el trabajo entre ambos.

Teniendo en cuenta lo anterior creo que mis aportaciones a las diferentes partes del proyecto se podrían enumera de la siguiente forma:

\subsubsection{Estado del arte}
Antes de comenzar a realizar este proyecto los directores del proyecto nos recomendaron la lectura de varios artículos científicos que hablaban sobre experimentos similares al nuestro en los que de una forma u otra se monitorizaba a pacientes con distintos síntomas de la enfermedad del Parkinson ya fuese para intentar identificar, usando técnicas de análisis de datos, las actividades que se estaban realizando entre un conjunto de actividades dadas o tan solo intentar identificar si un paciente sufría síntomas de la enfermedad o el grado de estos síntomas. La lectura en profundidad de estos artículos nos permitió tanto ser conscientes del contexto en el que se encuadraba nuestro proyecto como realizar el apartado de Estado del Arte de esta memoria. 

\subsubsection{Aplicación Android}

Dentro de la aplicación Android creo que mis aportaciones individuales destacan mas en el diseño e implementación de la base de datos local, así como en la integración con los sensores BLE mientras que en la parte de diseño e implementación de la interfaz de usuario mis aportaciones han sido menores.

\subsubsection{Aplicación web}
La aplicación web es una de las partes que esta realizada casi en su totalidad trabajando en grupo por lo que creo que tanto mi compañero como yo hemos aportado en prácticamente la totalidad del trabajo implementando las partes del back-end necesarias en PHP y todas las llamadas al API REST para recuperar y mostrar los datos en el cliente, dado que la parte de diseño esta inspirada en plantillas online.

\subsubsection{API REST}
Como el apartado anterior el API REST ha sido diseñado he implementado trabajando en grupo por lo que mis aportaciones cubren prácticamente el total del trabajo en este apartado, desde el diseño del esquema de datos a la implementación de esta usando el framework Eve.

\subsubsection{Despliegue de la infraestructura}
Esta sección es probablemente la sección en la que mis aportes personales destacan mas. Entre estas aportaciones se encuentran la de la creación de las imágenes de Docker usadas para desplegar los contenedores con el servidor web y el API REST y la implementación del script de despliegue, que permite la automatización del despliegue de la infraestructura.

\subsubsection{Procesamiento de datos}
El programa que se encarga de procesar los datos almacenados, por el API REST, en la base de datos remota es otra aportación grupal cuya lógica desarrollamos y pensamos mi compañero y yo trabajando en grupo.

\subsubsection{Otra aportaciones}
A parte de las contribuciones a los apartados principales del proyecto creo que es necesario mencionar el trabajo de pruebas realizadas para asegurar el correcto funcionamiento de cada parte del proyecto por separado y de la integración de todas ellas así como las aportaciones a la realización de la propia memoria del proyecto

\subsection{Alejandro Huertas Herrero}
Mi aportación al proyecto ha sido de un 50\% aproximadamente. Mi compañero y yo nos hemos repartido las tareas más o menos por igual. A continuación, voy a enumerar las partes en las que he trabajado, obviamente mi compañero también ha trabajado yo, pero las voy a describir desde mi punto de vista y trabajo realizado por mi.

\subsubsection{Lectura de artículos }
Al comienzo del TFG, por el mes de julio, empezamos a leernos artículos científicos, relacionados con el tema del trabajo. En mi caso, me leí un total de 7 artículos. De cada uno de ellos, hice un resumen extrayendo lo más útil para nuestro trabajo. Todos los artículos que analicé están mencionados en el apartado de estado del arte.

\subsubsection{Aplicación Android} 
Me he ocupado de todo lo relativo al diseño de la aplicación, así cómo de la conexión de la aplicación con la API Rest. Decidí hacer esto yo, porque durante mi primer trabajo estuve trabajando con Android y sabía muy bien como manejarme. El diseño de la aplicación lo he ido haciendo yo y acordando tanto con mi compañero como con nuestros directores. Aunque en menor medida, también he participado en la conexión de la aplicación con los sensores, sobre todo, en la conexión de los sensores Hexiwear. Otra tarea muy importante, ha sido la búsqueda de toda la información necesaria para conectar los sensores a la aplicación, nos pasamos muchísimo tiempo buscando por Internet cómo se conectaban, hasta que mi compañero dio con una solución viable.
    
\subsubsection{Aplicación Web} 
Cuando se nos propuso hacer la aplicación web para cerrar el TFG, me puse a buscar plantillas que fueran sencillas y tuvieran todo lo necesario. Acabé encontrando una plantilla que utiliza Bootstrap. Modifiqué la plantilla para dejar el diseño como lo necesitábamos nosotros. También me he encargado junto a mi compañero de realizar todo el Javascript necesario, así como el PHP que nos permite comunicarnos con la API Rest para obtener la información necesaria. La web la estamos haciendo los dos juntos, ninguno está aportando más que el otro, la hacemos a través de Skype y cuando podemos quedamos en persona.

\subsubsection{API Rest} 
Cuando pensamos en la idea de guardar los datos de la aplicación en un servidor, a los dos se nos vino a la cabeza la idea de utilizar MongoDB como sistema de almacenamiento. En ese momento buscamos si había algún framework disponible para Python que usara MongoDB, dimos con EVE. La verdad que es muy sencillo de utilizar, entre los dos elaboramos el fichero de settings que necesita para poder funcionar. También entre los dos, hicimos un script en Python que permite juntar los datos recogidos por cada sensor, de forma que se puedan procesar todos los datos de una persona a la vez.

\subsubsection{Memoria} 
La memoria la hemos divido a partes iguales, cada uno ha hecho la parte correspondiente a cada parte en la que más esfuerzo ha puesto. En mi caso, he hecho las partes relacionadas con Android, así como la descripción de los sensores de Texas y he participado en el resto de partes aportando o corrigiendo ciertas cosas.

\subsubsection{Organización}
Aunque nos hemos organizado juntos, yo he puesto más hincapié en utilizar aplicaciones como Trello, para poder llevar un control de todo lo que había que hacer y sobre todo de lo que tenía que hacer cada uno de nosotros.

\newpage
\begin{thebibliography}{10}
	\bibitem{resumen1}
    Shyamal Patel, Konrad Lorincz, Richard Hughes, Nancy Huggins, John H. Growdon, Matt Welsh, Paolo 		Bonato, Senior Member, IEEE. "Analysis of Feature Space for Monitoring Persons with Parkinson’s
	Disease With Application to a Wireless Wearable Sensor System"
    \bibitem{resumen2}
    Walter Maetzler, Josefa Domingos, Karin Srulijes, Joaquim J. Ferreira, Bastiaan R. Bloem.       	     "Quantitative Wearable Sensors for Objective Assessment of Parkinson’s Disease"
    \bibitem{resumen3}
    BAUKJE DIJKSTRA, WIEBREN ZIJLSTRA, ERIK SCHERDER, YVO KAMSMA. "Detection of walking periods and 	     number of steps in older adults and patients with Parkinson’s disease: accuracy of a pedometer and       an accelerometry-based method"
    \bibitem{resumen4}
    Shyamal Patel, Konrad Lorincz, Richard Hughes, Nancy Huggins, John Growdon, David Standaert, Metin       Akay, Fellow, IEEE, Jennifer Dy, Matt Welsh, Member, IEEE, and Paolo Bonato, Senior Member, IEEE.       "Monitoring Motor Fluctuations in Patients With Parkinson’s Disease Using Wearable Sensors"
    \bibitem{Texas Instruments} http://www.ti.com/product/CC2650/description
    \bibitem{Wiki TI} http://processors.wiki.ti.com/index.php/CC2650\_SensorTag\_User's\_Guide
    \bibitem{App TI} https://play.google.com/store/apps/details?id=com.ti.ble.sensortag\&hl=es
\end{thebibliography}

\end{document}
